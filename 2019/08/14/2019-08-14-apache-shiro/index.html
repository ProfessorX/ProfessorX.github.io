<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"www.yxiao.org","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.8.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>
<meta name="description" content="In this post we will talk about (refer to) some posts with regard to Apache Shiro used in the user access control of ERP programs.">
<meta property="og:type" content="article">
<meta property="og:title" content="Apache Shiro Research and Investigation">
<meta property="og:url" content="http://www.yxiao.org/2019/08/14/2019-08-14-apache-shiro/index.html">
<meta property="og:site_name" content="Masdar Wireless">
<meta property="og:description" content="In this post we will talk about (refer to) some posts with regard to Apache Shiro used in the user access control of ERP programs.">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2019-08-14T04:00:00.000Z">
<meta property="article:modified_time" content="2021-09-10T03:27:17.879Z">
<meta property="article:author" content="Abraham Xiao">
<meta property="article:tag" content="Java">
<meta property="article:tag" content="Programming">
<meta property="article:tag" content="ERP">
<meta property="article:tag" content="Apache">
<meta property="article:tag" content="Shiro">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://www.yxiao.org/2019/08/14/2019-08-14-apache-shiro/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"http://www.yxiao.org/2019/08/14/2019-08-14-apache-shiro/","path":"2019/08/14/2019-08-14-apache-shiro/","title":"Apache Shiro Research and Investigation"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Apache Shiro Research and Investigation | Masdar Wireless</title>
  




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Masdar Wireless</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">Shut Up and Get Rich</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li>
        <li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li>
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
        <li class="menu-item menu-item-study"><a href="/study/" rel="section"><i class="fa fa-book fa-fw"></i>study</a></li>
        <li class="menu-item menu-item-reading"><a href="/reading/" rel="section"><i class="fa fa-heartbeat fa-fw"></i>reading</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Application-Security-With-Apache-Shiro"><span class="nav-number">1.</span> <span class="nav-text">Application Security With Apache Shiro</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Core-Concepts-Subject-SecurityManager-and-Realms"><span class="nav-number">1.1.</span> <span class="nav-text">Core Concepts: Subject, SecurityManager, and Realms</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Subject"><span class="nav-number">1.1.1.</span> <span class="nav-text">Subject</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SecurityManager"><span class="nav-number">1.1.2.</span> <span class="nav-text">SecurityManager</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Realms"><span class="nav-number">1.1.3.</span> <span class="nav-text">Realms</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Authentication"><span class="nav-number">2.</span> <span class="nav-text">Authentication</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Authorization"><span class="nav-number">3.</span> <span class="nav-text">Authorization</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Abraham Xiao"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">Abraham Xiao</p>
  <div class="site-description" itemprop="description">A personal website with some posts from Zhihu also</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">278</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">12</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">413</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/ProfessorX" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;ProfessorX" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:admin@yxiao.org" title="E-Mail → mailto:admin@yxiao.org" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.yxiao.org/2019/08/14/2019-08-14-apache-shiro/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Abraham Xiao">
      <meta itemprop="description" content="A personal website with some posts from Zhihu also">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Masdar Wireless">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Apache Shiro Research and Investigation
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-08-14 12:00:00" itemprop="dateCreated datePublished" datetime="2019-08-14T12:00:00+08:00">2019-08-14</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-09-10 11:27:17" itemprop="dateModified" datetime="2021-09-10T11:27:17+08:00">2021-09-10</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Programming/" itemprop="url" rel="index"><span itemprop="name">Programming</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <p>In this post we will talk about (refer to) some posts with regard to Apache Shiro used in the user access control of ERP programs.</p>
<span id="more"></span>

<h2 id="Application-Security-With-Apache-Shiro"><a href="#Application-Security-With-Apache-Shiro" class="headerlink" title="Application Security With Apache Shiro"></a>Application Security With Apache Shiro</h2><h3 id="Core-Concepts-Subject-SecurityManager-and-Realms"><a href="#Core-Concepts-Subject-SecurityManager-and-Realms" class="headerlink" title="Core Concepts: Subject, SecurityManager, and Realms"></a>Core Concepts: Subject, SecurityManager, and Realms</h3><p>Now that we’ve covered Shiro’s benefits, let’s jump right in to its API so you can get a feel for it. Shiro’s architecture has three main concepts - the Subject, the SecurityManager, and Realms.</p>
<h4 id="Subject"><a href="#Subject" class="headerlink" title="Subject"></a>Subject</h4><p>When you’re securing your application, probably the most relevant questions to ask yourself are, “Who is the current user?” or “Is the current user allowed to do X”? It is common for us to ask ourselves these questions as we’re writing code or designing user interfaces: applications are usually built based on user stories, and you want functionality represented (and secured) based on a per-user basis. So, the most natural way for us to think about security in our application is based on the current user. Shiro’s API fundamentally represents this way of thinking in its Subject concept.</p>
<p>The word Subject is a security term that basically means “the currently executing user”. It’s just not called a ‘User’ because the word ‘User’ is usually associated with a human being. In the security world, the term ‘Subject’ can mean a human being, but also a 3rd party process, daemon account, or anything similar. It simply means ‘the thing that is currently interacting with the software’. For most intents and purposes though, you can think of this as Shiro’s ‘User’ concept. You can easily acquire the Shiro Subject anywhere in your code as shown in Listing 1 below.</p>
<p><strong>Listing 1. Acquiring the Subject</strong><br><code>import org.apache.shiro.subject.Subject; import org.apache.shiro.SecurityUtils; ... Subject currentUser = SecurityUtils.getSubject();</code></p>
<p>Once you acquire the Subject, you immediately have access to 90% of everything you’d want to do with Shiro for the current user, such as login, logout, access their session, execute authorization checks, and more - but more on this later. The key point here is that Shiro’s API is largely intuitive because it reflects the natural tendency for developers to think in ‘per-user’ security control. It is also easy to access a Subject anywhere in code, allowing security operations to occur anywhere they are needed.</p>
<h4 id="SecurityManager"><a href="#SecurityManager" class="headerlink" title="SecurityManager"></a>SecurityManager</h4><p>The Subject’s ‘behind the scenes’ counterpart is the SecurityManager. While the Subject represents security operations for the current user, the SecurityManager manages security operations for all users. It is the heart of Shiro’s architecture and acts as a sort of ‘umbrella’ object that references many internally nested security components that form an object graph. However, once the SecurityManager and its internal object graph is configured, it is usually left alone and application developers spend almost all of their time with the Subject API.</p>
<p>So how do you set up a SecurityManager? Well, that depends on your application environment. For example, a web application will usually specify a Shiro Servlet Filter in web.xml, and that will set up the SecurityManager instance. If you’re running a standalone application, you’ll need to configure it another way. But there are many of configuration options.</p>
<p>There is almost always a single SecurityManager instance per application. It is essentially an application singleton (although it does not need to be a static singleton). Like almost all things in Shiro, the default SecurityManager implementations are POJOs and are configurable with any POJO-compatible configuration mechanism - normal Java code, Spring XML, YAML, .properties and .ini files, etc. Basically anything that is capable of instantiating classes and calling JavaBeans-compatible methods may be used.</p>
<p>To that end, Shiro provides a default ‘common denominator’ solution via text-based INI configuration. INI is easy to read, simple to use, and requires very few dependencies. You’ll also see that with a simple understanding of object graph navigation, INI can be used effectively to configure simple object graph like the SecurityManager. Note that Shiro also supports Spring XML configuration and other alternatives, but we’ll cover INI here.</p>
<p>The simplest example of configuring Shiro based on INI is shown in the example in Listing 2 below.</p>
<p><strong>Listing 2. Configuring Shrio with INI</strong><br><code>[main] cm = org.apache.shiro.authc.credential.HashedCredentialsMatcher cm.hashAlgorithm = SHA-512 cm.hashIterations = 1024 Base64 encoding (less text): cm.storedCredentialsHexEncoded = false</code></p>
<p>iniRealm.credentialsMatcher = $cm</p>
<p>[users]<br>jdoe = TWFuIGlzIGRpc3Rpbmd1aXNoZWQsIG5vdCBvbmx5IGJpcyByZWFzb2<br>asmith = IHNpbmd1bGFyIHBhc3Npb24gZnJvbSBvdGhlciBhbXNoZWQsIG5vdCB</p>
<p>In Listing 2, we see the example INI configuration we will use to configure the SecurityManager instance. There are two INI sections: [main] and [users].</p>
<p>The [main] section is where you configure the SecurityManager object and/or any objects (like Realms) used by the SecurityManager. In this example, we see two objects being configured:</p>
<p>The cm object, which is an instance of Shiro’s HashedCredentialsMatcher class. As you can see, various properties of the cm instance are being configured via ‘nested dot’ syntax - a convention used by the IniSecurityManagerFactory shown in Listing 3, to represent object graph navigation and property setting.<br>The iniRealm object, which is a component used by the SecurityManager to represent user accounts defined in the INI format.<br>The [users] section is where you can specify a static list of user accounts - convenient for simple applications or when testing.</p>
<p>For the purposes of this introduction, it is not important to understand the intricacies of each section, but rather to see that INI configuration is one simple way of configuring Shiro. For more detailed information on INI configuration, please see Shiro’s documentation.</p>
<p><strong>Listing 3. Loading shiro.ini Configuration File</strong><br><code>import org.apache.shiro.SecurityUtils; import org.apache.shiro.config.IniSecurityManagerFactory; import org.apache.shiro.mgt.SecurityManager; import org.apache.shiro.util.Factory;</code></p>
<p>//1. Load the INI configuration<br>Factory<SecurityManager> factory =<br>new IniSecurityManagerFactory(“classpath:shiro.ini”);</p>
<p>//2. Create the SecurityManager<br>SecurityManager securityManager = factory.getInstance();</p>
<p>//3. Make it accessible<br>SecurityUtils.setSecurityManager(securityManager);</p>
<p>In Listing 3, we see a three-step process in this simple example:</p>
<p>Load the INI configuration that will configure the SecurityManager and its constituent components.<br>Create the SecurityManager instance based on the configuration (using Shiro’s Factory concept that represents the Factory Method design pattern).<br>Make the SecurityManager singleton accessible to the application. In this simple example, we set it as a VM-static singleton, but this is usually not necessary - your application configuration mechanism can determine if you need to use static memory or not.</p>
<h4 id="Realms"><a href="#Realms" class="headerlink" title="Realms"></a>Realms</h4><p>The third and final core concept in Shiro is that of a Realm. A Realm acts as the ‘bridge’ or ‘connector’ between Shiro and your application’s security data. That is, when it comes time to actually interact with security-related data like user accounts to perform authentication (login) and authorization (access control), Shiro looks up many of these things from one or more Realms configured for an application.</p>
<p>In this sense a Realm is essentially a security-specific DAO: it encapsulates connection details for data sources and makes the associated data available to Shiro as needed. When configuring Shiro, you must specify at least one Realm to use for authentication and/or authorization. More than one Realm may be configured, but at least one is required.</p>
<p>Shiro provides out-of-the-box Realms to connect to a number of security data sources (aka directories) such as LDAP, relational databases (JDBC), text configuration sources like INI and properties files, and more. You can plug-in your own Realm implementations to represent custom data sources if the default Realms do not meet your needs. Listing 4 below is an example of configuring Shiro (via INI) to use an LDAP directory as one of the application’s Realms.</p>
<h2 id="Authentication"><a href="#Authentication" class="headerlink" title="Authentication"></a>Authentication</h2><p>Authentication is the process of verifying a user’s identity. That is, when a user authenticates with an application, they are proving they actually are who they say they are. This is also sometimes referred to as ‘login’. This is typically a three-step process.</p>
<ul>
<li>Collect the user’s identifying information, called principals, and supporting proof of identity, called credentials.</li>
<li>Submit the principals and credentials to the system.</li>
<li>If the submitted credentials match what the system expects for that user identity (principal), the user is considered authenticated. If they don’t match, the user is not considered authenticated.</li>
</ul>
<p>A common example of this process that everyone is familiar with is that of the username/password combination. When most users login to a software application, they usually provide their username (the principal) and their supporting password (the credential). If the password (or representation of it) stored in the system matches what the user specifies, they are considered authenticated.</p>
<p>Shiro supports this same workflow in a simple and intuitive way. As we’ve said, Shiro has a Subject-centric API - almost everything you care to do with Shiro at runtime is achieved by interacting with the currently executing Subject. So, to login a Subject, you simply call its login method, passing an AuthenticationToken instance that represents the submitted principals and credentials (in this case, a username and password). This example is shown in Listing 5 below.</p>
<p><strong>Listing 5. Subject Login</strong></p>
<p><code>//1. Acquire submitted principals and credentials:</code><br><code>AuthenticationToken token =</code><br><code>new UsernamePasswordToken(username, password);</code></p>
<p>//2. Get the current Subject:<br>Subject currentUser = SecurityUtils.getSubject();</p>
<p>//3. Login:<br>currentUser.login(token);</p>
<p>As you can see, Shiro’s API easily reflects the common workflow. You’ll continue to see this simplicity as a theme for all of the Subject’s operations. When the login method is called, the SecurityManager will receive the AuthenticationToken and dispatch it to one or more configured Realms to allow each to perform authentication checks as required. Each Realm has the ability to react to submitted AuthenticationTokens as necessary. But what happens if the login attempt fails? What if the user specified an incorrect password? You can handle failures by reacting to Shiro’s runtime AuthenticationException as shown in Listing 6.</p>
<p><strong>Listing 6. Handle Failed Login</strong></p>
<p><code>//3. Login: try &#123;     currentUser.login(token); &#125; catch (IncorrectCredentialsException ice) &#123; … &#125; catch (LockedAccountException lae) &#123; … &#125; … catch (AuthenticationException ae) &#123;… &#125; </code></p>
<p>You can choose to catch one of the AuthenticationException subclasses and react specifically, or generically handle any AuthenticationException (for example, show the user a generic “Incorrect username or password” message). The choice is yours depending on your application requirements.</p>
<p>After a Subject logs-in successfully, they are considered authenticated and usually you allow them to use your application. But just because a user proved their identity doesn’t mean that they can do whatever they want in your application. That begs the next question, “how do I control what the user is allowed to do or not?” Deciding what users are allowed to do is called authorization. We’ll cover how Shiro enables authorization next.</p>
<h2 id="Authorization"><a href="#Authorization" class="headerlink" title="Authorization"></a>Authorization</h2><p>Authorization is essentially access control - controlling what your users can access in your application, such as resources, web pages, etc. <strong>Most users perform access control by employing concepts such as roles and permissions.</strong> That is, a user is usually allowed to do something or not based on what roles and/or permissions are assigned to them. Your application can then control what functionality is exposed based on checks for these roles and permissions. As you might expect, the Subject API allows you to perform role and permission checks very easily. For example, the code snippet in Listing 7 shows how to check if a Subject has been assigned a certain role.</p>
<p><strong>Listing 7. Role Check</strong></p>
<p><code>if ( subject.hasRole(“administrator”) ) &#123;     //show the ‘Create User’ button &#125; else &#123;     //grey-out the button? &#125; </code></p>
<p>As you can see, your application can enable or disable functionality based on access control checks.</p>
<p>Permission checks are another way to perform authorization. Checking for roles as in the example above suffers from one significant flaw: <strong>you can’t add or delete roles at runtime.</strong> Your code is hard-coded with role names, so if you changed the role names and/or configuration, your code would be broken! If you need to be able to change a role’s meaning at runtime, or add or delete roles as desired, you have to rely on something else.</p>
<p>To that end, Shiro supports its notion of permissions. A permission is a raw statement of functionality, for example ‘open a door’, ‘create a blog entry’, ‘delete the ‘jsmith’ user’, etc. By having permissions reflect your application’s raw functionality, you only need to change permission checks when you change your application’s functionality. In turn, you can assign permissions to roles or to users as necessary at runtime.</p>
<p>As an example, shown in Listing 8 below, we can rewrite our previous role check and instead use a permission check.</p>
<p><strong>Listing 8. Permission Check</strong></p>
<p><code>if ( subject.isPermitted(“user:create”) ) &#123;     //show the ‘Create User’ button &#125; else &#123;     //grey-out the button? &#125; </code></p>
<p>This way, any role or user assigned the “user:create” permission can click the ‘Create User’ button, and those roles and assignments can even change at runtime, providing you with a very flexible security model.</p>
<p>The “user:create” string is an example of a permission string that adheres to certain parsing conventions. Shiro supports this convention out of the box with its WildcardPermission. Although out of scope for this introduction article, you’ll see that the WildcardPermission can be extremely flexible when creating security policies, and even supports things like instance-level access control.</p>
<p><strong>Listing 9. Instance-Level Permission Check</strong></p>
<p><code>if ( subject.isPermitted(“user:delete:jsmith”) ) &#123;</code><br><code>    //delete the ‘jsmith’ user</code><br><code>&#125; else &#123;</code><br><code>    //don’t delete ‘jsmith’</code><br><code>&#125;</code></p>
<p>This example shows that you can control, even down to a very fine-grained instance level, access to individual resources if you needed to. You could even invent your own permission syntax if you wanted to. See the Shiro Permission documentation for more information. Finally, just as with authentication, the above calls eventually make their way to the SecurityManager, which will consult one or more Realms to make the access control decisions. This allows a Realm to respond to both authentication and authorization operations as necessary.</p>
<p>So that is a brief overview of Shiro’s authorization capabilities. And while most security frameworks stop at authentication and authorization, Shiro provides much more. Next we’ll talk about Shiro’s advanced Session Management capabilities.</p>
<p><a name="JavaAuthorizationGuide-JavaAuthorizationGuidewithApacheShiro"></a><br>Java Authorization Guide with Apache Shiro<br>==========================================</p>
<p>Authorization, or access control, is the function of specifying access rights to resources. In other words, <em>who</em> has access to <em>what</em>.</p>
<p>Examples of authorization checks are: Is the user allowed to look at this webpage, edit this data, view this button, or print to this printer? Those are all decisions determining what a user has access to.</p>
<p><a name="JavaAuthorizationGuide-ElementsofAuthorization"></a><br>Elements of Authorization</p>
<hr>
<p>Authorization has three core elements that we reference quite a bit in Shiro– permissions, roles, and users.</p>
<p><a name="JavaAuthorizationGuide-PermissionsDefined"></a><br>#[[###Permissions Defined]]#</p>
<p>Permissions are the most atomic level of a security policy and they are statements of functionality. Permissions represent what can be done in your application. A well formed permission describes a resource types and what actions are possible when you interact with those resources. Can you <em>open</em> a <em>door</em>? Can you <em>read</em> a <em>file</em>? Can you <em>delete</em> a <em>customer record</em>? Can you <em>push</em> a <em>button</em>?</p>
<p>Common actions for data-related resources are create, read, update, and delete, commonly referred to as CRUD.</p>
<p>It is important to understand that permissions do not have knowledge of <em>who</em> can perform the actions– they are just statements of <em>what</em> actions can be performed.</p>
<p><a name="JavaAuthorizationGuide-Levelsofpermissiongranularity"></a><br>#[[####Levels of permission granularity]]#</p>
<p>The permissions above all specify an actions (open, read, delete, etc) on a resource (door, file, customer record, etc). In Shiro, you can define a permission to any depth you like. Here are a few common permission levels in order of granularity.</p>
<ul>
<li>  Resource Level - This is the broadest and easiest to build. A user can edit customer records or open doors. The resource is specified but not a specific instance of that resource.</li>
<li>  Instance Level - The permission specifies the instance of a resource. A user can edit the customer record for IBM or open the kitchen door.</li>
<li>  Attribute Level - The permission now specifies an attribute of an instance or resource. A user can edit the address on the IBM customer record.</li>
</ul>
<p>For more information on Permissions please check out the <a href="permissions.html" title="Permissions">Permissions Documentation</a></p>
<p><a name="JavaAuthorizationGuide-RolesDefined"></a><br>#[[###Roles Defined]]#</p>
<p>In the context of Authorization, Roles are effectively a collection of permissions used to simplify the management of permissions and users. So users can be assigned roles instead of being assigned permissions directly, which can get complicated with larger user bases and more complex applications. So, for example, a bank application might have an <em>administrator</em> role or a <em>bank teller</em> role.</p>
<p>There are two types of roles that you need to be aware of and Shiro will support both.</p>
<p><a name="JavaAuthorizationGuide-ImplicitRoles"></a><br>#[[####Implicit Roles]]#</p>
<p>Most people view roles as what we define as an implicit role where your application <em>implies</em> a set of permissions because a user has a particular role as opposed to the role explicitly being assigned permissions or your application checking for those permissions. Role checks in code are generally a reflection of an implicit role. You can view patient data because you have the <em>administrator</em> role. You can create an account because you have the <em>bank teller</em> role. The fact that these names exist does not have a correlation to what the software can actually do. Most people use roles in this manner. It is easiest but it can create a lot of maintenance and management problems for all but the simplest application.</p>
<p><a name="JavaAuthorizationGuide-ExplicitRoles"></a><br>#[[####Explicit Roles]]#</p>
<p>An explicit role has permissions <em>explicitly</em> assigned to it and therefore is an <em>explicit</em> collection of permissions. Permission checks in code are a reflection of an explicit role. You can view patient data because because you have the <em>view patient data</em> permission as part of your <em>administrator</em> role. You can create an account because you have the <em>create account</em> permission as part of your <em>bank teller</em> role. You can perform these actions, not because of some implicit role name based on a string but because the corresponding permission was explicitly assigned to your role.</p>
<p>The big benefits of explicit roles are easier manageability and lower maintenance of your application. If you ever need to add, remove, or change a role, you can do so without touching your source code. And in Shiro, you’ll also be able to dynamically add, remove, or change roles at runtime and your authorization checks will always have up to date values. This means you won’t have to force users to log out and log back in order to get their new permissions.</p>
<p><a name="JavaAuthorizationGuide-UsersDefined"></a><br>#[[###Users Defined]]#</p>
<p>A user is the “who” of an application. In Shiro, though, the concept of a user is really the <a href="subject.html" title="Subject">Subject</a> instance. We use word Subject instead of user because user usually implies a human being and in Shiro a Subject can be anything interacting with your application– whether it be a human or a service.</p>
<p>Users are allowed to perform certain actions in your application through their association with roles or direct permissions. So you are able to open a customer record because you’ve been assigned the <em>open customer record</em> permission, either through a role you’ve been assigned or through a direct permission assignment.</p>
<p>For more information on Users, aka Subjects, please check out the <a href="subject.html" title="Subject">Subject Documentation</a>.</p>
<p>#info(‘Note’, ‘Ultimately, your <a href="realm.html" title="Realm">Realm</a> implementation is what communicates with your data source (RDBMS, LDAP, etc). So your realm is what will tell Shiro whether or not roles or permissions exist. You have full control over how your authorization model works.’)</p>
<p><a name="JavaAuthorizationGuide-HowtoperformAuthorizationinJavawithShiro"></a><br>How to perform Authorization in Java with Shiro</p>
<hr>
<p>Authorization in Shiro can be handled in four ways.</p>
<ul>
<li>  Programmatically - You can perform authorization checks in your java code with structures like <code>if</code> and <code>else</code> blocks.</li>
<li>  JDK annotations - You can attach an authorization annotation to your Java methods</li>
<li>  JSP/GSP TagLibs - You can control jsp or gsp page output based on roles and permissions</li>
</ul>
<p><a name="JavaAuthorizationGuide-ProgrammaticAuthorization"></a><br>#[[###Programmatic Authorization]]#</p>
<p>Checking for permissions and roles, programmatically in your Java code is the traditional way of handling authorization. Here’s how you can perform a permission check or role check in Shiro.</p>
<p><a name="JavaAuthorizationGuide-RoleCheck"></a><br>#[[####Role Check]]#</p>
<p>This is an example of how you do a role check programmatically in your application. We want to check if a user has the <em>administrator</em> role and if they do, then we’ll show a special button, otherwise we won’t show it.</p>
<p>First we get access to the current user, the <a href="subject.html" title="Subject">Subject</a>. Then we pass the <em>adminstrator</em> to the Subject’s <a href="static/current/apidocs/org/apache/shiro/subject/Subject.html#%5B%5B#%5D%5D#hasRole-java.lang.String-"><code>.hasRole()</code></a> method. It will return <code>TRUE</code> or <code>FALSE</code>.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//get the current Subject</span></span><br><span class="line">Subject currentUser = SecurityUtils.getSubject();</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (currentUser.hasRole(<span class="string">&quot;administrator&quot;</span>)) &#123;</span><br><span class="line">    <span class="comment">//show a special button‏</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">//don’t show the button?)‏</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Now a role based check is quick and easy to implement but it has a major drawback. It is implicit.</p>
<p>What if you just want to add, remove, or redefine a role later? You’ll have to crack open your source code and change all your role checks to reflect the change in your security model. You’ll have to shut down the application, crack open the code, test it, and then restart it everytime.</p>
<p>In very simple applications this is probably good enough but for larger apps this can be a major problem throughout the life of your application and drive a large maintenance cost for your software.</p>
<p><a name="JavaAuthorizationGuide-PermissionCheck"></a><br>#[[####Permission Check]]#</p>
<p>This is an example of how you do security checks by permission. We want to check if a user has permission to print to laserjet3000n and if they do, then we’ll show a print button, otherwise we won’t show it. This is an example of an instance level permission or instance level authorization.</p>
<p>Again, first you get access to the current user, the <a href="subject.html" title="Subject">Subject</a>. Then you construct a <a href="static/current/apidocs/org/apache/shiro/authz/Permission.html"><code>Permission</code></a> object or an instance that represents an action on a resource. In this case, the instance is named <code>printerPermission</code>, the resource is <em>laserjet3000n</em>, and the action is <em>print</em>. Then we pass <code>printerPermission</code> to the Subject’s <a href="static/current/apidocs/org/apache/shiro/subject/Subject.html#%5B%5B#%5D%5D#isPermitted-java.util.List-"><code>.isPermitted()</code></a> method. It will return true or false.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Subject currentUser = SecurityUtils.getSubject();</span><br><span class="line"></span><br><span class="line">Permission printPermission = <span class="keyword">new</span> PrinterPermission(<span class="string">&quot;laserjet3000n&quot;</span>,<span class="string">&quot;print&quot;</span>);</span><br><span class="line"></span><br><span class="line">If (currentUser.isPermitted(printPermission)) &#123;</span><br><span class="line">    <span class="comment">//do one thing (show the print button?)‏</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">//don’t show the button?</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a name="JavaAuthorizationGuide-PermissionCheck%28Stringbased%29"></a><br>#[[####Permission Check (String-based)]]#</p>
<p>You can also a permission check using a simple string instead of a permission class.</p>
<p>So, if you don’t want to implement our <a href="static/current/apidocs/org/apache/shiro/authz/Permission.html">permission interface</a> then you just pass in a String. In this example, we pass the <code>.isPermitted()</code> method a string, <code>printer:print:LaserJet4400n</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">String perm = <span class="string">&quot;printer:print:laserjet4400n&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(currentUser.isPermitted(perm))&#123;</span><br><span class="line">    <span class="comment">//show the print button?</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">//don’t show the button?</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>You can construct the permission string the way you want so long as your <a href="realm.html" title="Realm">Realm</a> knows how to work with it. In this example we use Shiro’s optional permission syntax, <a href="permissions.html" title="Permissions">WildCardPermissions</a>. WildCardPermissions are powerful and intuitive. If you’d like to learn more about them then check out the <a href="static/current/apidocs/org/apache/shiro/authz/Permission.html">Permissions Documentation</a>.</p>
<p>With string-based permission checks, you get the same functionality as the example before. The benefit is that you are not forced to implement a permission interface and you can construct the permission via a simple string. The downside is that you don’t have type safety and if you needed more complicated permission capabilities that are outside the scope of what this represents, you’re going to want to implement your own permission objects based on the permission interface.</p>
<p><a name="JavaAuthorizationGuide-AnnotationAuthorization"></a><br>#[[###Annotation Authorization]]#</p>
<p>If you don’t want to do code level authorization checks, then you can use Java Annotations as well. Shiro offers a number of <a href="java-annotations-list.html" title="Java Annotations List">Java annotations</a> that allow you to annotate methods.</p>
<p><a name="JavaAuthorizationGuide-EnablingAnnotationSupport"></a><br>#[[####Enabling Annotation Support]]#</p>
<p>Before you can use Java annotations, you’ll need to enable AOP support in your application. There are a number of different AOP frameworks so, unfortunately, there is no standard way to enable AOP in an application.</p>
<p>For AspectJ, you can review our <a target="_blank" rel="noopener" href="https://github.com/apache/shiro/tree/master/samples/aspectj">AspectJ sample application</a>.</p>
<p>For Spring, you can look into our <a href="spring.html" title="Spring">Spring Integration</a> documentation.</p>
<p>For Guice, you can look into our <a href="guice.html" title="Guice">Guice Integration</a> documentation.</p>
<p><a name="JavaAuthorizationGuide-PermissionCheck"></a><br>#[[####Permission Check]]#</p>
<p>In this example, we want to check that a user has the <code>account:create</code> permission before they can invoke the <code>openAccount</code> method. If they do, then the method is called as expected, and if they don’t, then an exception is thrown.</p>
<p>Like programmatic checks, you can use the <a href="static/current/apidocs/org/apache/shiro/authz/Permission.html">Permission</a> objects or the simple string methods with this annotation.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Will throw an AuthorizationException if none</span></span><br><span class="line"><span class="comment">//of the caller’s roles imply the Account</span></span><br><span class="line"><span class="comment">//&#x27;create&#x27; permission</span></span><br><span class="line"><span class="meta">@RequiresPermissions(&quot;account:create&quot;)</span>‏</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">openAccount</span><span class="params">( Account acct )</span> </span>&#123;</span><br><span class="line">    <span class="comment">//create the account</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a name="JavaAuthorizationGuide-RoleCheck"></a><br>#[[####Role Check]]#</p>
<p>In this example, we want to check that a user has the <code>teller</code> role before they can invoke the <code>openAccount</code> method. If they do, then the method is called as expected, and if they don’t, then an exception is thrown.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Throws an AuthorizationException if the caller</span></span><br><span class="line"><span class="comment">//doesn’t have the ‘teller’ role:</span></span><br><span class="line"><span class="meta">@RequiresRoles( &quot;teller&quot; )</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">openAccount</span><span class="params">( Account acct )</span> </span>&#123;</span><br><span class="line">    <span class="comment">//do something in here that only a teller</span></span><br><span class="line">    <span class="comment">//should do</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a name="JavaAuthorizationGuide-JSPTagLibAuthorization"></a><br>#[[###JSP TagLib Authorization]]#</p>
<p>For JSP/GSP based web applications, Shiro also offers a <a href="jsp-tag-library.html" title="JSP Tag Library">tag library</a> for you to use.</p>
<p>In this example, we’re going to show users with the <em>users:manage</em> permission a link to the Manage Users page. If they do not have the permission, then we’ll show them a nice message.</p>
<p>First, we’ll need to add the Shiro taglib to our web application. Next, we add the <code>&lt;shiro:hasPermission&gt;</code> tag with a check for <em>users:manage</em>. Within the <code>&lt;shiro:hasPermission&gt;</code> tags we will place the code we want to execute if the user has the permission we’re checking for. If we want to take an action if the user lacks the permission, then we need to also add the <code>&lt;shiro:lacksPermission&gt;</code> tag, again checking for <em>users:manage</em>. And any code we want to excute if the user lacks the permission will need to be placed within the <code>&lt;shiro:lacksPermission&gt;</code> tags.</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ taglib prefix=&quot;shiro&quot; uri=http://shiro.apache.org/tags %&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">shiro:hasPermission</span> <span class="attr">name</span>=<span class="string">&quot;users:manage&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;manageUsers.jsp&quot;</span>&gt;</span></span><br><span class="line">            Click here to manage users</span><br><span class="line">        <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">shiro:hasPermission</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">shiro:lacksPermission</span> <span class="attr">name</span>=<span class="string">&quot;users:manage&quot;</span>&gt;</span></span><br><span class="line">        No user management for you!</span><br><span class="line">    <span class="tag">&lt;/<span class="name">shiro:lacksPermission</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Of course, there also tags for checking roles and other user data and states.</p>
<p>For more information on JSP/GSP Tags please check out the <a href="jsp-tag-library.html" title="JSP Tag Library">JSP Tag Library</a> and for more information on integration your application in your web application, please read the <a href="web.html" title="Web">Web Integration Documentation</a></p>
<p><a name="JavaAuthorizationGuide-CachingAuthorization"></a><br>Caching Authorization</p>
<hr>
<p>TBD</p>
<p>#lendAHandDoc()</p>
<p><input type="hidden" id="ghEditPage" value="java-authorization-guide.md.vtl"></input></p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Java/" rel="tag"># Java</a>
              <a href="/tags/Programming/" rel="tag"># Programming</a>
              <a href="/tags/ERP/" rel="tag"># ERP</a>
              <a href="/tags/Apache/" rel="tag"># Apache</a>
              <a href="/tags/Shiro/" rel="tag"># Shiro</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2019/08/13/2019-08-13-she-hui-ren/" rel="prev" title="为什么一些高冷漂亮的女生都被一些痞痞的「社会人」追到了？">
                  <i class="fa fa-chevron-left"></i> 为什么一些高冷漂亮的女生都被一些痞痞的「社会人」追到了？
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2019/08/15/2019-08-15-java-authorization-with-apache-shiro/" rel="next" title="Java Authorization Guide with Apache Shiro">
                  Java Authorization Guide with Apache Shiro <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 2013 – 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Abraham Xiao</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  
<script src="https://cdn.jsdelivr.net/npm/hexo-generator-searchdb@1.4.0/dist/search.js" integrity="sha256-vXZMYLEqsROAXkEw93GGIvaB2ab+QW6w3+1ahD9nXXA=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>





  





</body>
</html>
